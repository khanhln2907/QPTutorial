# Header

## Project Structure
A PlatformIO-project (PIOP) has the following structure:

	├── Project/
		├── .git/
		├── include/			/* Project headerfiles*/         
		├── src/				/* Project source files: *.h, *.c, *.cpp, *.S, *.ino, etc.*/
		├── lib/   				/* Project private libraries*/
		├── test/				/* Project testing scripts & libraries*/
		├── .gitignore
		└── platformio.ini
      
(Tree is generated by https://tree.nathanfriend.io/?s=

...

	There is no sense to use global or extra library storage if you use PlatformIO Registry. PlatformIO caches downloaded packages and API requests. So, depending on the same packages in the different configuration environments will not lead to multiple package downloading. If you don't want PlatformIO to manage your dependencies, then please don't use lib_deps. You can manage dependencies manually and later just instruct PlatformIO to use the libraries which you prepared in some storage.
	https://github.com/platformio/platformio-core/issues/4206#issuecomment-1078881377


## Snapshot of CUAV Project - 12/01/2023 
	├── cuav/
       	├── FlightComputerUnit
            ├── include/
            ├── src/
                └── main.cpp					/* CUAV Main Programm */
            ├── lib/
            |   ├── FlightComputer/				/* FC's logic: sync, parsing MC */
            |   |   ├── include/
            |   |   ├── src/
            |   ├── NAVComputer/				/* Guidance Logic */
            |   |   ├── include/
            |   |   ├── src/
            └──	├── TargetObserver/				/* Compute Target's Info */
                |   ├── include/
              	|   └── src/
            
        ├── SensorFusionUnit
        
        ├── Dependencies/ 
            ├── DroneSensors/
            │   ├── lib/
            │   │   ├── i2c/
            │   │   ├── wire/
            │   │   ├── spi/
            │   │   └── ...
            │   ├── include/
            │   │   ├── sensor1.hpp
            │   │   ├── sensor2.hpp
            │   │   └── sensorFusion12.hpp
            │ 	└── src/
            │       ├── sensor1.cpp
            │       ├── sensor2.cpp
            │       └── sensorFusion12.cpp
            
            ├── QP/
            │   ├── include/
            │   │   └── qpcpp.hpp
            │   │   └──  ...
            │   ├── src/
            │       └── qf_pkg.hpp
            │       └── qs_pkg.hpp
            │       └── qxk_pkg.hpp
            │       ├── qf/
            │       ├── qk/
            │       ├── qs/
            │       ├── qv/            
            │       └── qxk/
            
            ├── DroneLogger/
            │   ├── include/
            │   │   ├── DroneLogger.hpp
            │   │   └── TypeSerialization.hpp
            │   ├── src/
            │   │   └── DroneLogger.cpp
            │   └── lib/
            
            ├── FlightController/
            │   ├── include/
            │   │   ├── PID.hpp
            │   │   ├── Mixer.hpp
            │   │   ├── QuadcopterController.hpp
            │   │   └── Parameters.hpp
            │   └── src/
            │       ├── QuadcopterController.cpp
            │       └── PID.cpp
            
            ├── Math/
            │   └── include/
            │       └── BasicTypes.hpp
            
            ├── Tools/
            │   └── include/
            |   |   └── BiquadFilter.h
            |   |   └── MathTools.h
            |   |   └── CircularBuffer.h
            |   |   └── ...
            │   └── src/
            |       └── BiquadFilter.cpp
            |       └── MathTools.cpp
            |       └── CircularBuffer.cpp
            |       └── ...
            
            ├── Drone-API/
            
            ├── HardwareConfig/
            
            ├── InterSystemMessages/
            
            └── MISC/

### Built by PlatformIO
	Dependency Graph
      |-- qpcpp @ 7.0.1
      |-- ArduinoLog @ 0.0.0+20220407152254
      |-- Tools @ 0.0.0+20220407152254
      |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |-- qpcpp @ 7.0.1
      |-- FlightComputer @ 0.0
      |   |-- qpcpp @ 7.0.1
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |   |-- qpcpp @ 7.0.1
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- ArduinoLog @ 0.0.0+20220407152254
      |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |-- qpcpp @ 7.0.1
      |-- NAVComputer @ 0.0
      |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- qpcpp @ 7.0.1
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |-- DroneSensors @ 0.0.0+20220407152254
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- qpcpp @ 7.0.1
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- t4spi
      |-- t4spi
      |-- TargetObserver @ 0.0
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- qpcpp @ 7.0.1
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |-- FlightController @ 0.0.0+20220407152254.sha.4aa5528
      |   |-- qpcpp @ 7.0.1
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- Servo @ 1.1.2
      |-- Servo @ 1.1.2
      |-- dronelogger
      |   |-- qpcpp @ 7.0.1
      |   |-- Drone-API @ 0.0.0+20220407152254.sha.e02555e
      |   |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |   |-- qpcpp @ 7.0.1
      |   |   |-- qpcpp @ 7.0.1
      |   |   |-- Tools @ 0.0.0+20220407152254
      |   |   |-- ArduinoLog @ 0.0.0+20220407152254
      |   |-- math @ 0.0.0+20220407152254.sha.e2f1b3d
      |   |-- HardwareConfig @ 0.0.0+20220407152254.sha.7a8ed79
      |   |   |-- qpcpp @ 7.0.1
      |   |-- Tools @ 0.0.0+20220407152254
      |   |-- InterSystemMessages @ 0.0.0+20220407152254.sha.10ce183
      |   |   |-- qpcpp @ 7.0.1
      |   |-- ArduinoLog @ 0.0.0+20220407152254

## Proposal of New Project Structure from 12/01/2023 

### PlatformIO.ini
Current Version: PlatformIO 6.1.5


#### Common Modules
#### Library Dependencies
Check this [link](https://docs.platformio.org/en/latest/librarymanager/dependencies.html#library-registry) first for an overview and some good/ bad practices

There are three ways to declare the dependencies files ([link](https://docs.platformio.org/en/latest/librarymanager/configuration.html))

- Put the related repos/ projects directly in **lib** folder
	Pro:
	 	+ Developing with .gitsubmodules fashion
	Con:
	  - Not convenient if several application projects are monitored simultaneously. For example, four projects SFU, MC, TC, and CCU use DroneAPI. If each project clone DroneAPI into their **lib** folders, any changes/ conflict in the DroneAPI require git push/pull multiple times.

* [lib_deps](https://docs.platformio.org/en/latest/projectconf/sections/env/options/library/lib_deps.html)
	PlatformIO imports (makes a copy) these libraries, then integrate them into the project that is being compiled.
  
  Pro:
		+ Easy importing open-source libraries (e.g. Arduino/ sensors modules) by specifying their info 
  
  $\implies$ no need to clone and specify the libraries path) 
		+ Import the common projects throough Git URLs with specific branch and tag 
  $\implies$ **reliable code deployment**.
	Con:
		- ...

* [lib_extra_dirs](https://docs.platformio.org/en/latest/projectconf/sections/env/options/library/lib_ignore.html)

	[+] Easy to integrate local projects
	[+] When the imported projects are not yet stable, i.e., the imported modules are developed/ extended parallel with the new modules.

  $\implies$ **convenient for the developemnt process**. 
  
 !TODO: describe the testing sequence: fix -> push -> pull -> deploy ..
 	
 
 
 
Example:
			


#### 

	cuav/
	├── CCU (Command Control Unit)/
	│   ├── lib/
	│   │   ├── MCU (Mission Computer Unit)/
	│   │   │   ├── lib/
	│   │   │   └── src/  
	│   │   ├── NAVComputer/              /* Guidance */
	│   │   ├── FlightComputer/           /* FC High Level Commanders */
	│   │   ├── FlightController.git/     /* Flight Controller: PID, Mixer, PID Profiles, etc. */
	│   │   └── TargetObserver/           /* Compute Target */
	│   └── src/
	│       └── main.cpp                  /* Main programm of CUAV */
	├── SFU (Sensor Fusion Unit)/
	│   ├── lib/
	│   │   └── DroneSensors.git/          /* Specific Sensor Drivers */       
	│   └── src/
	├── TCU (Target Computer Unit)/
	│   ├── lib/
	│   │   └── TargetComputer.git/    
	│   └── src/
	└── Common/
		├── MathCore.git/
		├── DroneAPI.git/
		├── InterSystemMessages.git/
		├── DroneLogger.git/
		├── AMDCDrivers.git/            /* Plain Drivers, e.g., sensor drivers, mixer drivers, etc. */
		├── QPDrivers.git/              /* QP Drivers, e.g., QP sensors QP SerialParser, QP EthernetParser, etc. */
		└── CustomTeensyCore.git/       /* Enhanced Serial, I2C, SPI, Core,... libraries for MCU */
	LIB_DEPS/
	└── ReleasedLibraries/              /* External Libraries */    
		├── QP/
		└── Eigen/


### Subprojects
	

### FlightComputer
	├── FlightComputerUnit
		├── include/
		├── src/
   			└── main.cpp					/* CUAV Main Programm */
		├── lib/
		|	├── FlightComputer/				/* FC's logic: sync, parsing MC */
 		|		├── include/
		|		└── src/
		|	├── NAVComputer/				/* Guidance Logic */
		|		├── include/
		|		└── src/
		|	├── TargetObserver/				/* Compute Target's Info */
		|		├── include/
		|		└── src/
		|	├── TargetObserver/				/* Compute Target's Info */
		|   ├── include/
		|   └── src/



## Best Practices for Project Developments with PlatformIO

https://docs.platformio.org/en/latest/advanced/unit-testing/structure/best-practices.html

